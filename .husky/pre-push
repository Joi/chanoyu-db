#!/bin/sh
# Portable Husky hook that won't fail if helper script is missing
if [ -f "$(dirname "$0")/_/husky.sh" ]; then
  . "$(dirname "$0")/_/husky.sh"
fi

# Ensure we run from repo root
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null || pwd)"
cd "$REPO_ROOT" || exit 1

run_ci=0
# Read refs from stdin to detect branch
while read local_ref local_sha remote_ref remote_sha; do
  case "$remote_ref" in
    refs/heads/dev) run_ci=1 ;;
  esac
done

if [ "$run_ci" = "1" ]; then
  echo "Running CI (lint+typecheck+tests+build) locally before push to dev..."
  npm run ci:local || exit 1
fi
exit 0
